<meta:Type
  xmlns:meta="class:/spiralcraft/data/types/meta/"
  xmlns:bizm="class:/spiralcraft/biz/meta/"
  xmlns:entity="class:/spiralcraft/archetype/entity/"
  xmlns:dt="class:/spiralcraft/data/task/"
  xmlns:ju="class:/java/util/"
  >
  
  <!-- 
    An asset account associated with customer receivables
  -->
  <baseType><bizm:TradeAccount.type/>
  </baseType>
  
  <fields>
    <meta:RelativeField>
      <name>projects
      </name>
      
      <type><bizm:CustomerProject.list.type/>
      </type>
      
      <referencedFieldList>customerId
      </referencedFieldList>
    </meta:RelativeField>
    
    <meta:Field>
      <name>orgUnitId
      </name>
      <type><LSID.type/>
      </type>
    </meta:Field>
    <meta:Field>
      <name>paymentTermsId
      </name>
      <type><LSID.type/>
      </type>
    </meta:Field>
    <meta:Field>
      <name>paymentMethodId
      </name>
      <type><LSID.type/>
      </type>
    </meta:Field>
  </fields>
  
  <methods>
    <meta:TransactionMethod>
      <name>openNewSalesOrder
      </name>
      <returnType><bizm:SalesOrder.type/>
      </returnType>
      <x>
        [*dt:Edit
          {typeX:=[@bizm:SalesOrder].type
          ,action:=
            `@{
              .orgUnitId=[bizm:CustomerAccount].orgUnitId??"100"
              , customerId=[bizm:CustomerAccount].accountId
              ,.billToId=[bizm:CustomerAccount].contactId 
              ,.paymentTermsId=[bizm:CustomerAccount].paymentTermsId??"1"
              ,.paymentMethodId=[bizm:CustomerAccount].paymentMethodId??"1"
              ,.openDate=[@ju:Date].()
            }`
        }].()
      </x>
    </meta:TransactionMethod>
  </methods>
</meta:Type>